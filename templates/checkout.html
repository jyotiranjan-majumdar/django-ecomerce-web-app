{% extends "base.html" %}

<script>
{% block jquery %} 

// Set your publishable key: remember to change this to your live publishable key in production
// See your keys here: https://dashboard.stripe.com/account/apikeys
{% comment %} var stripe = Stripe('pk_test_51HJ261HEKXuyg5UVyzHzcZrhg3GtY2RkF3DGMv1U1wn8vClpTK5DjA3SePALYqOjlUi4DBbjVmC94azZnDodXczV00RINRMY6R');
var elements = stripe.elements(); {% endcomment %}

Stripe.setPublishableKey('{{ stripe_pub }}');

// Create a token or display an error when the form is submitted.
var form = document.getElementById('payment-form');
form.addEventListener('submit', function(event) {
  event.preventDefault();

  stripe.createToken(card).then(function(result) {
    if (result.error) {
      // Inform the customer that there was an error.
      var errorElement = document.getElementById('card-errors');
      errorElement.textContent = result.error.message;
    } else {
      // Send the token to your server.
      stripeTokenHandler(result.token);
    }
  });
});


function stripeTokenHandler(token) {
  // Insert the token ID into the form so it gets submitted to the server
  var form = document.getElementById('payment-form');
  var hiddenInput = document.createElement('input');
  hiddenInput.setAttribute('type', 'hidden');
  hiddenInput.setAttribute('name', 'stripeToken');
  hiddenInput.setAttribute('value', token.id);
  form.appendChild(hiddenInput);

  // Submit the form
  form.submit();
}


{% endblock %}
</script>


{% block content %}

 <div class="container">
    <div class="row">
        <div class="col">
            <form method='POST' id="payment-form" action=""> {% csrf_token %}

                {% if current_addresses %}
                <h3> Shipping Address </h3>
                {% for address in current_addresses %}
                {% if request.user.userdefaultaddress.shipping.id == address.id %} 
                <input type='radio' name='shipping_address' value='{{ address.id }}' checked= 'checked'/ > {{address.get_address}} </br>
                {% else %}
                <input type='radio' name='shipping_address' value='{{ address.id }}'/ > {{address.get_address}} </br>

                {% endif %}
                {% endfor %}    
                {% endif %}
                
                <div class="row">
                <div class=".col-sm">
                </br> <h3>card info </h3>
                
                

                <form action="/charge" method="post" >
                <div class="form-row">
               <label for="card-element">
               Credit or debit card
                  </label>
                  <div id="card-element">

                <!-- A Stripe Element will be inserted here. -->
                  <label>
                  <span>Card Number </span>
                  <input type="text" size="20" data-stripe="number" />
                  </label>
                  </div>
                
                  <div class="form-row">
                  <label>
                  <span> Card Expiration date(MM/YYYY)</span>
                  <input type="text" size="2" data-stripe="exp-month"/>
                  <span> / </span>
                  <input type="text" size="4" data-stripe="exp-year"/>
                  </label>
                  </div>

                  <div class="form-row">
                  <label>
                  <span> Card three digit CVC Numver </span>
                  <input type="text" size="4" data-stripe="cvc"/>
                  </label>
                  </div>



                  <!-- Used to display Element errors. -->
                  <div id="card-errors" role="alert"></div>
                </div>

                 <button>Submit Payment</button>
               


                



                </div>
                </div>


                
               {% comment %} <h3> Billing Address </h3>
                {% if billing_addresses %}
                {% for address in billing_addresses%}
                <input type='radio' name='billing_address' value='{{ address.id }}'/ > {{address.get_address}} </br>
                {% endfor %}       
                {% endif %} {% endcomment %}
                    
         </form>
     </div>
    
        <div class="col">
                    {% if address_form %}
                    <h3> Add New Shipping </h3>
                    <form method="POST" action='{% url "add_user_address" %}?next=checkout'> {% csrf_token %}
                    {{address_form.as_p}}
                    <input type='submit' class='btn btn-lg btn-primary' value='Add Address' />
                    {% endif %}
        </div>
    </div>
        
 </div>
{% endblock %}